var x$=($)=>typeof $==="function",Q$=($)=>x$($)&&/^async\s+/.test($.toString()),c=($)=>(K)=>K instanceof $,o=c(Error),X$=c(Promise);var H$="Computed",S=($,K)=>{K=K??Q$($);let B=new Set,x,Z=null,z=!0,j=()=>{if(z=!0,K)s(B)},D=()=>{try{return $(x)}catch(V){return o(V)?V:new Error(`Error during reactive computation: ${V}`)}},W=(V)=>{z=!1,x=V,Z=null},W$=(V)=>{z=!0,Z=V},Y$=(V)=>o(V)?W$(V):W(V),D$={[Symbol.toStringTag]:H$,get:()=>{if(i(B),!K||z)r(()=>{let V=D();X$(V)?V.then(Y$).catch(W$):Y$(V)},j);if(o(Z))throw Z;return x},map:(V)=>S(()=>V(D$.get()))};return D$},Z$=($)=>!!$&&typeof $==="object"&&$[Symbol.toStringTag]===H$;var E,z$=!1,V$=new Set,b=($)=>U($)||Z$($),i=($)=>{if(E)$.add(E)},s=($)=>$.forEach((K)=>z$?V$.add(K):K()),r=($,K)=>{let B=E;E=K,$(),E=B},_$=($)=>{z$=!0,$(),z$=!1,V$.forEach((K)=>K()),V$.clear()};var _=Symbol();class v{$;watchers=new Set;constructor($){this.value=$}get(){return i(this.watchers),this.value}set($){if(_!==$){let K=x$($)?$(this.value):$;if(Object.is(this.value,K))return;this.value=K}if(s(this.watchers),_===$)this.watchers.clear()}map($){return S(()=>$(this.get()))}}var j$=($)=>new v($),U=c(v);var n=($)=>{let K=()=>r(()=>{try{$()}catch(B){console.error(B)}},K);K()};var Q=($)=>typeof $==="function";var g=($)=>(K)=>K instanceof $,u=($)=>g(Error)($),F=function(){return this};var X=($)=>$==null?Y():L$($)?$:f($),L$=($)=>y($)||w($);class T{static instance=new T;get=()=>{return}}var I=T.prototype;I.map=I.chain=I.filter=I.guard=I.catch=F;I.or=($)=>X($());I.match=function($){return Q($.Nil)?$.Nil():this};var Y=()=>T.instance,w=($)=>$===T.instance;class N{$;constructor($){this.value=$}get(){return this.value}}var M=N.prototype;M.map=function($){return new N($(this.value))};M.chain=function($){return $(this.value)};M.filter=M.guard=function($){return $(this.value)?this:Y()};M.or=M.catch=F;M.match=function($){return Q($.Ok)?$.Ok(this.value):this};var f=($)=>new N($),y=g(N);class h{$;constructor($){this.error=$}get(){throw this.error}}var G=h.prototype;G.map=G.chain=F;G.filter=G.guard=()=>Y();G.or=($)=>X($());G.catch=function($){return $(this.error)};G.match=function($){return Q($.Err)?$.Err(this.error):this};var q=($)=>new h(u($)?$:new Error(String($))),k=g(h);var P=($,...K)=>{try{return l($(...K))}catch(B){return q(B)}},C$=async($,...K)=>{try{return l(await $(...K))}catch(B){return q(B)}},g$=async(...$)=>{let K=Q($[0])?Y():l($.shift());for(let B of $){if(k(K))break;if(!Q(B))return q(new TypeError("Expected a function in flow"));K=/^async\s+/.test(B.toString())?await C$(async()=>B(K.get())):P(B,K.get())}return K},t=($)=>y($)||w($)||k($),l=($)=>$==null?Y():t($)?$:u($)?q($):f($),f$=($)=>k($)?$.error:y($)||w($)?$.get():$;var J=($)=>typeof $==="function",a=($)=>!!$&&typeof $==="object",h$=($)=>typeof $==="number",R=($)=>typeof $==="string",k$=($)=>typeof $==="symbol",I$=($)=>R($)||k$($)||h$($);var d$="debug";var p$="warn",H="error",m$=($)=>$?`#${$}`:"",c$=($)=>$.length?`.${Array.from($).join(".")}`:"",M$=($)=>`<${$.localName}${m$($.id)}${c$($.classList)}>`,e=($)=>R($)?`"${$}"`:a($)?JSON.stringify($):String($),L=($,K,B=d$)=>{if([H,p$].includes(B))console[B](K,$);return $};class d{$;K;constructor($,K=[$]){this.host=$;this.targets=K}on($,K){return this.targets.forEach((B)=>B.addEventListener($,K)),this}off($,K){return this.targets.forEach((B)=>B.removeEventListener($,K)),this}pass($){return this.targets.forEach(async(K)=>{if(await O.registry.whenDefined(K.localName),K instanceof O)Object.entries($).forEach(([B,x])=>{let Z=I$(x)?this.host.signals.get(x):$$(x);if(Z)K.set(B,Z);else L(x,`Invalid source for state ${e(B)}`,H)});else L(K,"Target is not a Capsula",H)}),this}sync(...$){return this.targets.forEach((K,B)=>$.forEach((x)=>x(this.host,K,B))),this}}var p=($,K,B,x=void 0)=>{let Z=$.constructor.states[K];return J(Z)&&!!Z.length?Z(B,$,x):B},rK=($)=>$!=null,vK=($)=>X($).map(parseInt).filter(Number.isFinite).get(),nK=($)=>X($).map(parseFloat).filter(Number.isFinite).get(),uK=($)=>$,tK=($)=>(K)=>X(K).filter((B)=>$.includes(B.toLowerCase())).get(),lK=($)=>P(()=>$?JSON.parse($):null).match({Err:(K)=>{L(K,"Failed to parse JSON",H);return}}).get();var G$="context-request";class S$ extends Event{$;K;B;constructor($,K,B=!1){super(G$,{bubbles:!0,composed:!0});this.context=$;this.callback=K;this.subscribe=B}}var A$=($)=>{let K=$.constructor,B=K.consumedContexts||[];setTimeout(()=>{for(let Z of B)$.dispatchEvent(new S$(Z,(z)=>$.set(String(Z),z)))});let x=K.providedContexts||[];if(!x.length)return!1;return $.addEventListener(G$,(Z)=>{let{context:z,callback:j}=Z;if(!x.includes(z)||!J(j))return;Z.stopPropagation(),j($.signals.get(String(z)))}),!0};var $$=($)=>b($)?$:J($)?S($,!0):j$($);class O extends HTMLElement{static registry=customElements;static states={};static observedAttributes;static consumedContexts;static providedContexts;static define($){P(()=>O.registry.define($,this)).match({Err:(K)=>L($,K.message,H),Ok:()=>!1})}signals=new Map;self=new d(this);root=this.shadowRoot||this;debug=!1;attributeChangedCallback($,K,B){if(B===K)return;this.set($,p(this,$,B,K))}connectedCallback(){Object.entries(this.constructor.states).forEach(([$,K])=>{let B=J(K)?p(this,$,this.getAttribute($)??void 0,void 0):K;this.set($,B,!1)}),A$(this)}disconnectedCallback(){}adoptedCallback(){}has($){return this.signals.has($)}get($){let K=(x)=>!a(x)?x:J(x)?K(x()):b(x)||t(x)?K(x.get()):x;return K(this.signals.get($))}set($,K,B=!0){let x;if(!this.signals.has($))x="Create",this.signals.set($,$$(K));else if(B){let Z=this.signals.get($);if(b(K)){if(x="Replace",this.signals.set($,K),U(Z))Z.set(_)}else if(U(Z))x="Update",Z.set(K);else{L(K,`Computed state ${e($)} in ${M$(this)} cannot be set`,H);return}}else return}delete($){return this.signals.delete($)}first($){let K=this.root.querySelector($);return new d(this,K?[K]:[])}all($){return new d(this,Array.from(this.root.querySelectorAll($)))}}if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=($)=>setTimeout($,16);var K$=new Map,m=[],B$,U$=()=>{B$=null,m.forEach(($)=>$()),m=[],K$.clear()},o$=()=>{if(B$)cancelAnimationFrame(B$);B$=requestAnimationFrame(U$)};queueMicrotask(U$);var A=($,K)=>new Promise((B,x)=>{let Z=()=>{try{B($())}catch(z){x(z)}};if(K){let[z,j]=K;if(!K$.has(z))K$.set(z,new Map);let D=K$.get(z);if(D.has(j)){let W=m.indexOf($);if(W>-1)m.splice(W,1)}D.set(j,Z)}m.push(Z),o$()}),F$=async()=>new Promise(requestAnimationFrame);var w$=($)=>$.nodeType===Node.COMMENT_NODE,i$=($)=>!/^on/i.test($),s$=($)=>{if(/^(mailto|tel):/i.test($))return!0;if($.includes("://"))try{let K=new URL($,window.location.origin);return!["http:","https:","ftp:"].includes(K.protocol)}catch(K){return!0}return!0},J$=($,K,B)=>{if(!i$(K))throw new Error(`Unsafe attribute: ${K}`);if(B=String(B).trim(),!s$(B))throw new Error(`Unsafe URL for ${K}: ${B}`);$.setAttribute(K,B)};var y$=($,K,B={},x)=>A(()=>{let Z=document.createElement(K);for(let[z,j]of Object.entries(B))J$(Z,z,j);if(x)Z.textContent=x;return $.append(Z),Z},[$,"e"]),T$=($)=>A(()=>{return $.remove(),null},[$,"r"]),N$=($,K)=>A(()=>{return Array.from($.childNodes).filter((B)=>!w$(B)).forEach((B)=>B.remove()),$.append(document.createTextNode(K)),$},[$,"t"]),q$=($,K,B)=>A(()=>{return J$($,K,B),$},[$,`a:${K}`]),P$=($,K)=>A(()=>{return $.removeAttribute(K),$},[$,`a:${K}`]),R$=($,K,B)=>A(()=>{return $.toggleAttribute(K,B),$},[$,`a:${K}`]),O$=($,K,B)=>A(()=>{return $.classList.toggle(K,B),$},[$,`c:${K}`]),E$=($,K,B)=>A(()=>{return $.style.setProperty(K,B),$},[$,`s:${K}`]),b$=($,K)=>A(()=>{return $.style.removeProperty(K),$},[$,`s:${K}`]);var SB=($,K=$)=>(B,x)=>n(()=>{x.dispatchEvent(new CustomEvent($,{detail:B.get(K),bubbles:!0}))}),C=($,K)=>(B,x)=>{let{read:Z,update:z}=K,j=Z(x);if(!J($)){let D=R($)&&R(j)?p(B,$,j):j;B.set($,D,!1)}n(()=>{let D=Z(x),W=J($)?$(D):B.get($);if(!Object.is(W,D)){if(W===null&&K.delete)K.delete(x);else if(W==null&&j)z(x,j);else if(W!=null)z(x,W)}})},UB=($,K)=>C(K,{read:()=>null,update:(B,x)=>y$(B,$,x)}),FB=($)=>C($,{read:(K)=>K!=null,update:(K,B)=>B?T$(K):Promise.resolve(null)}),wB=($)=>C($,{read:(K)=>K.textContent,update:(K,B)=>N$(K,B)}),yB=($,K=$)=>C(K,{read:(B)=>B[$],update:(B,x)=>B[$]=x}),TB=($,K=$)=>C(K,{read:(B)=>B.getAttribute($),update:(B,x)=>q$(B,$,x),delete:(B)=>P$(B,$)}),NB=($,K=$)=>C(K,{read:(B)=>B.hasAttribute($),update:(B,x)=>R$(B,$,x)}),qB=($,K=$)=>C(K,{read:(B)=>B.classList.contains($),update:(B,x)=>O$(B,$,x)}),PB=($,K=$)=>C(K,{read:(B)=>B.style.getPropertyValue($),update:(B,x)=>E$(B,$,x),delete:(B)=>b$(B,$)});export{A$ as useContext,C as updateElement,qB as toggleClass,NB as toggleAttribute,$$ as toSignal,l as toResult,j$ as state,wB as setText,PB as setStyle,yB as setProperty,TB as setAttribute,P as result,FB as removeElement,p as parse,f as ok,Y as nil,X as maybe,U as isState,b as isSignal,t as isResult,y as isOk,w as isNil,L$ as isMaybe,k as isErr,Z$ as isComputed,f$ as fromResult,g$ as flow,q as err,A as enqueue,SB as emit,n as effect,UB as createElement,S as computed,_$ as batch,C$ as asyncResult,uK as asString,nK as asNumber,lK as asJSON,vK as asInteger,tK as asEnum,rK as asBoolean,F$ as animationFrame,_ as UNSET,v as State,N as Ok,T as Nil,h as Err,O as Capsula};
