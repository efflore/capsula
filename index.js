var e=($)=>typeof $==="function",J$=($)=>e($)&&/^async\s+/.test($.toString()),d=($)=>(B)=>B instanceof $,f=d(Error),V$=d(Promise);var W$="Computed",D=($,B)=>{B=B??J$($);let K=new Set,Q,X=null,z=!0,J=()=>{if(z=!0,B)m(K)},x=()=>{try{return $()}catch(Z){return f(Z)?Z:new Error(`Error during reactive computation: ${Z}`)}},W=(Z)=>{z=!1,Q=Z,X=null},X$=(Z)=>{z=!0,X=Z},Z$=(Z)=>f(Z)?X$(Z):W(Z),z$={[Symbol.toStringTag]:W$,get:()=>{if(p(K),!B||z)c(()=>{let Z=x();V$(Z)?Z.then(Z$).catch(X$):Z$(Z)},J);if(f(X))throw X;return Q},map:(Z)=>D(()=>Z(z$.get()))};return z$},$$=($)=>!!$&&typeof $==="object"&&$[Symbol.toStringTag]===W$;var T,S$=!1,L$=new Set,G=($)=>y($)||$$($),p=($)=>{if(T)$.add(T)},m=($)=>$.forEach((B)=>S$?L$.add(B):B()),c=($,B)=>{let K=T;T=B,$(),T=K};class o{$;watchers=new Set;constructor($){this.value=$}get(){return p(this.watchers),this.value}set($){let B=e($)?$(this.value):$;if(Object.is(this.value,B))return;this.value=B,m(this.watchers)}map($){return D(()=>$(this.get()))}}var B$=($)=>new o($),y=d(o);var i=($)=>{let B=()=>c(()=>{try{$()}catch(K){console.error(K)}},B);B()};var F=($)=>typeof $==="function";var P=($)=>(B)=>B instanceof $,v=($)=>P(Error)($),I=function(){return this};var H=($)=>$==null?j():Y$($)?$:O($),Y$=($)=>E($)||R($);class q{static instance=new q;get=()=>{return}}var N=q.prototype;N.map=N.chain=N.filter=N.guard=N.catch=I;N.or=($)=>H($());N.match=function($){return F($.Nil)?$.Nil():this};var j=()=>q.instance,R=($)=>$===q.instance;class S{$;constructor($){this.value=$}get(){return this.value}}var U=S.prototype;U.map=function($){return new S($(this.value))};U.chain=function($){return $(this.value)};U.filter=U.guard=function($){return $(this.value)?this:j()};U.or=U.catch=I;U.match=function($){return F($.Ok)?$.Ok(this.value):this};var O=($)=>new S($),E=P(S);class b{$;constructor($){this.error=$}get(){throw this.error}}var w=b.prototype;w.map=w.chain=I;w.filter=w.guard=()=>j();w.or=($)=>H($());w.catch=function($){return $(this.error)};w.match=function($){return F($.Err)?$.Err(this.error):this};var s=($)=>new b(v($)?$:new Error(String($))),K$=P(b);var _=($,...B)=>{try{return x$($(...B))}catch(K){return s(K)}};var n=($)=>E($)||R($)||K$($),x$=($)=>$==null?j():n($)?$:v($)?s($):O($);var Y=($)=>typeof $==="function",r=($)=>!!$&&typeof $==="object",T$=($)=>typeof $==="number",L=($)=>typeof $==="string",y$=($)=>typeof $==="symbol",H$=($)=>L($)||y$($)||T$($);var P$="debug";var R$="warn",A="error",O$=($)=>$?`#${$}`:"",E$=($)=>$.length?`.${Array.from($).join(".")}`:"",j$=($)=>`<${$.localName}${O$($.id)}${E$($.classList)}>`,u=($)=>L($)?`"${$}"`:r($)?JSON.stringify($):String($),M=($,B,K=P$)=>{if(!1==="true"||[A,R$].includes(K))console[K](B,$);return $};var b$=($,B)=>{return H$(B)?$.signals.get(B):G(B)?B:Y(B)&&!B.length?D(B):void 0};class k{$;B;constructor($,B=[$]){this.host=$;this.targets=B}on($,B){return this.targets.forEach((K)=>K.addEventListener($,B)),this}off($,B){return this.targets.forEach((K)=>K.removeEventListener($,B)),this}pass($){return this.targets.forEach((B)=>{if(B instanceof h)this.host.constructor.registry.whenDefined(B.tagName).then(()=>{Object.entries($).forEach(([K,Q])=>{let X=b$(this.host,Q);if(X)B.set(K,X);else M(Q,`Invalid source for state ${u(K)}`,A)})});else M(B,"Target is not a Capsula instance",A)}),this}sync(...$){return this.targets.forEach((B)=>$.forEach((K)=>K(this.host,B))),this}}var _$=($)=>Y($)&&!!$.length,l=($,B,K,Q=void 0)=>{let X=$.constructor.states[B];return _$(X)?X(K,$,Q):K},o4=($)=>$!=null,i4=($)=>H($).map(parseInt).filter(Number.isFinite).get(),v4=($)=>H($).map(parseFloat).filter(Number.isFinite).get(),s4=($)=>$,n4=($)=>(B)=>H(B).filter((K)=>$.includes(K.toLowerCase())).get(),r4=($)=>_(()=>$?JSON.parse($):null).match({Err:(B)=>{M(B,"Failed to parse JSON",A);return}}).get();class h extends HTMLElement{static registry=customElements;static states={};static observedAttributes=[];static define($){_(()=>h.registry.define($,this)).match({Err:(B)=>M($,B.message,A),Ok:()=>!1})}signals=new Map;internals;self=new k(this);root=this.shadowRoot||this;debug=!1;attributeChangedCallback($,B,K){if(K===B)return;this.set($,l(this,$,K,B))}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}has($){return this.signals.has($)}get($){let B=(Q)=>!r(Q)?Q:Y(Q)?B(Q()):G(Q)||n(Q)?B(Q.get()):Q;return B(this.signals.get($))}set($,B,K=!0){if(!this.signals.has($))this.signals.set($,G(B)?B:Y(B)&&!B.length?D(B):B$(B));else if(K){let Q=this.signals.get($);if(G(B))this.signals.set($,B);else if(y(Q))Q.set(B);else M(B,`Computed state ${u($)} in ${j$(this)} cannot be set`,A)}}delete($){return this.signals.delete($)}first($){let B=this.root.querySelector($);return new k(this,B?[B]:[])}all($){return new k(this,Array.from(this.root.querySelectorAll($)))}}if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=($)=>setTimeout($,16);var t=new Map,g=[],a,A$=()=>{a=null,g.forEach(($)=>$()),g=[],t.clear()},k$=()=>{if(a)cancelAnimationFrame(a);a=requestAnimationFrame(A$)};queueMicrotask(A$);var V=($,B)=>new Promise((K,Q)=>{let X=()=>{try{K($())}catch(z){Q(z)}};if(B){let[z,J]=B;if(!t.has(z))t.set(z,new Map);let x=t.get(z);if(x.has(J)){let W=g.indexOf($);if(W>-1)g.splice(W,1)}x.set(J,X)}g.push(X),k$()});var D$=($)=>$.nodeType===Node.COMMENT_NODE,h$=($)=>!/^on/i.test($),g$=($)=>{if(/^(mailto|tel):/i.test($))return!0;if($.includes("://"))try{let B=new URL($,window.location.origin);return!["http:","https:","ftp:"].includes(B.protocol)}catch(B){return!0}return!0},Q$=($,B,K)=>{if(!h$(B))throw new Error(`Unsafe attribute: ${B}`);if(!g$(K))throw new Error(`Unsafe URL for ${B}: ${K}`);$.setAttribute(B,K)};var M$=($,B,K={},Q)=>V(()=>{let X=document.createElement(B);for(let[z,J]of Object.entries(K))Q$(X,z,J);if(Q)X.textContent=Q;return $.append(X),X},[$,"e"]),C$=($)=>V(()=>{return $.remove(),null},[$,"r"]),G$=($,B)=>V(()=>{return Array.from($.childNodes).filter((K)=>!D$(K)).forEach((K)=>K.remove()),$.append(document.createTextNode(B)),$},[$,"t"]),F$=($,B,K)=>V(()=>{return Q$($,B,K),$},[$,`a:${B}`]),N$=($,B)=>V(()=>{return $.removeAttribute(B),$},[$,`a:${B}`]),U$=($,B,K)=>V(()=>{return $.toggleAttribute(B,K),$},[$,`a:${B}`]),w$=($,B,K)=>V(()=>{return $.classList.toggle(B,K),$},[$,`c:${B}`]),I$=($,B,K)=>V(()=>{return $.style.setProperty(B,K),$},[$,`s:${B}`]),q$=($,B)=>V(()=>{return $.style.removeProperty(B),$},[$,`s:${B}`]);var CB=($,B=$)=>(K,Q)=>i(()=>{Q.dispatchEvent(new CustomEvent($,{detail:K.get(B),bubbles:!0}))}),C=($,B)=>(K,Q)=>{let{read:X,update:z}=B,J=X(Q);if(!Y($)){let x=L($)&&L(J)?l(K,$,J):J;K.set($,x,!1)}i(()=>{let x=X(Q),W=Y($)?$(x):K.get($);if(!Object.is(W,x)){if(W===null&&B.delete)B.delete(Q);else if(W==null&&J)z(Q,J);else if(W!=null)z(Q,W)}})},GB=($,B)=>C(B,{read:()=>null,update:(K,Q)=>M$(K,$,Q)}),FB=($)=>C($,{read:(B)=>B!=null,update:(B,K)=>K?C$(B):Promise.resolve(null)}),NB=($)=>C($,{read:(B)=>B.textContent,update:(B,K)=>G$(B,K)}),UB=($,B=$)=>C(B,{read:(K)=>K[$],update:(K,Q)=>K[$]=Q}),wB=($,B=$)=>C(B,{read:(K)=>K.getAttribute($),update:(K,Q)=>F$(K,$,Q),delete:(K)=>N$(K,$)}),IB=($,B=$)=>C(B,{read:(K)=>K.hasAttribute($),update:(K,Q)=>U$(K,$,Q)}),qB=($,B=$)=>C(B,{read:(K)=>K.classList.contains($),update:(K,Q)=>w$(K,$,Q)}),SB=($,B=$)=>C(B,{read:(K)=>K.style.getPropertyValue($),update:(K,Q)=>I$(K,$,Q),delete:(K)=>q$(K,$)});export{C as updateElement,qB as toggleClass,IB as toggleAttribute,NB as setText,SB as setStyle,UB as setProperty,wB as setAttribute,FB as removeElement,l as parse,CB as emit,GB as createElement,s4 as asString,v4 as asNumber,r4 as asJSON,i4 as asInteger,n4 as asEnum,o4 as asBoolean,h as Capsula};
