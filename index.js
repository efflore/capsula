var w=(y)=>typeof y==="function",s=(y)=>w(y)&&/^async\s+/.test(y.toString()),M=(y)=>($)=>$ instanceof y,g=M(Error),m=M(Promise);var n="Computed",x=(y,$)=>{$=$??s(y);let K=[],A,B=null,j=!0,z=()=>{if(j=!0,$)O(K)},V={[Symbol.toStringTag]:n,get:()=>{if($)T(K);if(!$||j)E(()=>{let P=(D)=>{A=D,j=!1,B=null},r=(D)=>{B=g(D)?D:new Error(`Computed function failed: ${D}`)};try{let D=y(A);m(D)?D.then(P).catch(r):P(D)}catch(D){r(D)}},z);if(g(B))throw B;return A},map:(P)=>x(()=>P(V.get()))};return V},o=(y)=>!!y&&typeof y==="object"&&y[Symbol.toStringTag]===n;var X,h=!1,d=[],C=(y)=>Q(y)||o(y),H=(y,$=!1)=>C(y)?y:w(y)?x(y,$):q(y),T=(y)=>{if(X&&!y.includes(X))y.push(X)},O=(y)=>y.forEach(($)=>h?d.push($):$()),E=(y,$)=>{let K=X;X=$,y(),X=K},v=(y)=>{h=!0,y(),h=!1,d.forEach(($)=>$()),d.length=0};var L=Symbol();class R{y;watchers=[];constructor(y){this.value=y}get(){return T(this.watchers),this.value}set(y){if(L!==y){let $=w(y)?y(this.value):y;if(Object.is(this.value,$))return;this.value=$}if(O(this.watchers),L===y)this.watchers=[]}map(y){return x(()=>y(this.get()))}}var q=(y)=>new R(y),Q=M(R);var G=(y)=>{let $=()=>E(()=>{try{y()}catch(K){console.error(K)}},$);$()};if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=(y)=>setTimeout(y,16);var _=new Map,S=[],b,u=()=>{b=null,S.forEach((y)=>y()),S=[],_.clear()},fy=()=>{if(b)cancelAnimationFrame(b);b=requestAnimationFrame(u)};queueMicrotask(u);var Z=(y,$)=>new Promise((K,A)=>{let B=()=>{try{K(y())}catch(j){A(j)}};if($){let[j,z]=$;if(!_.has(j))_.set(j,new Map);let V=_.get(j);if(V.has(z)){let P=S.indexOf(y);if(P>-1)S.splice(P,1)}V.set(z,B)}S.push(B),fy()}),t=async()=>new Promise(requestAnimationFrame);var a=(y)=>y.nodeType===Node.COMMENT_NODE,xy=(y)=>!/^on/i.test(y),Qy=(y)=>{if(/^(mailto|tel):/i.test(y))return!0;if(y.includes("://"))try{let $=new URL(y,window.location.origin);return!["http:","https:","ftp:"].includes($.protocol)}catch($){return!0}return!0},p=(y,$,K)=>{if(!xy($))throw new Error(`Unsafe attribute: ${$}`);if(K=String(K).trim(),!Qy(K))throw new Error(`Unsafe URL for ${$}: ${K}`);y.setAttribute($,K)};var l=(y,$,K={},A)=>Z(()=>{let B=document.createElement($);for(let[j,z]of Object.entries(K))p(B,j,z);if(A)B.textContent=A;return y.append(B),B},[y,"e"]),e=(y)=>Z(()=>{return y.remove(),null},[y,"r"]),yy=(y,$)=>Z(()=>{return Array.from(y.childNodes).filter((K)=>!a(K)).forEach((K)=>K.remove()),y.append(document.createTextNode($)),y},[y,"t"]),$y=(y,$,K)=>Z(()=>{return p(y,$,K),y},[y,`a:${$}`]),Ky=(y,$)=>Z(()=>{return y.removeAttribute($),y},[y,`a:${$}`]),Ay=(y,$,K)=>Z(()=>{return y.toggleAttribute($,K),y},[y,`a:${$}`]),By=(y,$,K)=>Z(()=>{return y.classList.toggle($,K),y},[y,`c:${$}`]),jy=(y,$,K)=>Z(()=>{return y.style.setProperty($,K),y},[y,`s:${$}`]),zy=(y,$)=>Z(()=>{return y.style.removeProperty($),y},[y,`s:${$}`]);var W=(y)=>typeof y==="function",i=(y)=>!!y&&typeof y==="object",Xy=(y)=>typeof y==="number",N=(y)=>typeof y==="string",Cy=(y)=>typeof y==="symbol",Py=(y)=>N(y)||Cy(y)||Xy(y);var Zy="debug",Hy="info",Dy="warn",J="error",Ly=(y)=>y?`#${y}`:"",Ny=(y)=>y.length?`.${Array.from(y).join(".")}`:"",Vy=(y)=>`<${y.localName}${Ly(y.id)}${Ny(y.classList)}>`,k=(y)=>N(y)?`"${y}"`:i(y)?JSON.stringify(y):String(y),Y=(y,$,K=Zy)=>{if([J,Dy].includes(K))console[K]($,y);return y};class F{y;$;constructor(y,$=[y]){this.host=y;this.targets=$}on(y,$){return this.targets.forEach((K)=>K.addEventListener(y,$)),this}off(y,$){return this.targets.forEach((K)=>K.removeEventListener(y,$)),this}pass(y){return this.targets.forEach(async($)=>{if(await I.registry.whenDefined($.localName),$ instanceof I)Object.entries(y).forEach(([K,A])=>{let B=Py(A)?this.host.signals.get(A):H(A,!0);if(B)$.set(K,B);else Y(A,`Invalid source for state ${k(K)}`,J)});else Y($,"Target is not a Capsula",J)}),this}sync(...y){return this.targets.forEach(($,K)=>y.forEach((A)=>A(this.host,$,K))),this}}var Wy=(y,$)=>{if($==null)return;let K=y($);return Number.isFinite(K)?K:void 0},U=(y,$,K,A=void 0)=>{let B=y.constructor.states[$];return W(B)&&!!B.length?B(K,y,A):K},Iy=(y)=>y!=null,Uy=(y)=>Wy(parseInt,y),wy=(y)=>Wy(parseFloat,y),Gy=(y)=>y,Sy=(y)=>($)=>{if($==null)return;return y.includes($.toLowerCase())?$:void 0},Fy=(y)=>{if(y==null)return;try{return JSON.parse(y)}catch($){Y($,"Failed to parse JSON",J);return}};var Jy="context-request";class Yy extends Event{y;$;K;constructor(y,$,K=!1){super(Jy,{bubbles:!0,composed:!0});this.context=y;this.callback=$;this.subscribe=K}}var c=(y)=>{let $=y.constructor,K=$.consumedContexts||[];setTimeout(()=>{for(let B of K)y.dispatchEvent(new Yy(B,(j)=>y.set(String(B),j)))});let A=$.providedContexts||[];if(!A.length)return!1;return y.addEventListener(Jy,(B)=>{let{context:j,callback:z}=B;if(!A.includes(j)||!W(z))return;B.stopPropagation(),z(y.signals.get(String(j)))}),!0};class I extends HTMLElement{static registry=customElements;static states={};static observedAttributes;static consumedContexts;static providedContexts;static define(y){try{I.registry.define(y,this)}catch($){Y($,`Failed to register custom element ${y}`,J)}}signals=new Map;self=new F(this);root=this.shadowRoot||this;debug=!1;attributeChangedCallback(y,$,K){if(K===$)return;this.set(y,U(this,y,K,$))}connectedCallback(){Object.entries(this.constructor.states).forEach(([y,$])=>{let K=W($)?U(this,y,this.getAttribute(y)??void 0,void 0):$;this.set(y,K,!1)}),c(this)}disconnectedCallback(){}adoptedCallback(){}has(y){return this.signals.has(y)}get(y){let $=(A)=>!i(A)?A:W(A)?$(A()):C(A)?$(A.get()):A;return $(this.signals.get(y))}set(y,$,K=!0){let A;if(!this.signals.has(y))this.signals.set(y,H($,!0));else if(K){let B=this.signals.get(y);if(C($)){if(this.signals.set(y,$),Q(B))B.set(L)}else if(Q(B))B.set($);else{Y($,`Computed state ${k(y)} in ${Vy(this)} cannot be set`,J);return}}else return}delete(y){return this.signals.delete(y)}first(y){let $=this.root.querySelector(y);return new F(this,$?[$]:[])}all(y){return new F(this,Array.from(this.root.querySelectorAll(y)))}}var My=(y,$=y)=>(K,A)=>G(()=>{A.dispatchEvent(new CustomEvent(y,{detail:K.get($),bubbles:!0}))}),f=(y,$)=>(K,A)=>{let{read:B,update:j}=$,z=B(A);if(!W(y)){let V=N(y)&&N(z)?U(K,y,z):z;K.set(y,V,!1)}G(()=>{let V=B(A),P=W(y)?y(V):K.get(y);if(!Object.is(P,V)){if(P===null&&$.delete)$.delete(A);else if(P==null&&z)j(A,z);else if(P!=null)j(A,P)}})},Ty=(y,$)=>f($,{read:()=>null,update:(K,A)=>l(K,y,A)}),Oy=(y)=>f(y,{read:($)=>$!=null,update:($,K)=>K?e($):Promise.resolve(null)}),Ey=(y)=>f(y,{read:($)=>$.textContent,update:($,K)=>yy($,K)}),qy=(y,$=y)=>f($,{read:(K)=>K[y],update:(K,A)=>K[y]=A}),Ry=(y,$=y)=>f($,{read:(K)=>K.getAttribute(y),update:(K,A)=>$y(K,y,A),delete:(K)=>Ky(K,y)}),_y=(y,$=y)=>f($,{read:(K)=>K.hasAttribute(y),update:(K,A)=>Ay(K,y,A)}),by=(y,$=y)=>f($,{read:(K)=>K.classList.contains(y),update:(K,A)=>By(K,y,A)}),iy=(y,$=y)=>f($,{read:(K)=>K.style.getPropertyValue(y),update:(K,A)=>jy(K,y,A),delete:(K)=>zy(K,y)});export{c as useContext,f as updateElement,by as toggleClass,_y as toggleAttribute,H as toSignal,q as state,Ey as setText,iy as setStyle,qy as setProperty,Ry as setAttribute,Oy as removeElement,U as parse,Y as log,Q as isState,C as isSignal,Z as enqueue,My as emit,G as effect,Ty as createElement,x as computed,v as batch,Gy as asString,wy as asNumber,Fy as asJSON,Uy as asInteger,Sy as asEnum,Iy as asBoolean,t as animationFrame,L as UNSET,Dy as LOG_WARN,Hy as LOG_INFO,J as LOG_ERROR,Zy as LOG_DEBUG,I as Capsula};
