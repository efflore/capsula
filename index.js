var m=(x)=>typeof x==="function",r=(x)=>m(x)&&/^async\s+/.test(x.toString()),U=(x)=>(q)=>q instanceof x,w=U(Error),t=U(Promise);var l="Computed",b=(x,q)=>{q=q??r(x);let z=new Set,B,J=null,N=!0,Kx=()=>{if(N=!0,q)P(z)},Qx=()=>{try{return x()}catch(H){return w(H)?H:new Error(`Error during reactive computation: ${H}`)}},Xx=(H)=>{N=!1,B=H,J=null},i=(H)=>{N=!0,J=H},s=(H)=>w(H)?i(H):Xx(H),u={[Symbol.toStringTag]:l,get:()=>{if(R(z),!q||N)f(()=>{let H=Qx();t(H)?H.then(s).catch(i):s(H)},Kx);if(w(J))throw J;return B},map:(H)=>b(()=>H(u.get()))};return u},h=(x)=>!!x&&typeof x==="object"&&x[Symbol.toStringTag]===l;var Y,Zx=!1,$x=new Set,D=(x)=>F(x)||h(x),R=(x)=>{if(Y)x.add(Y)},P=(x)=>x.forEach((q)=>Zx?$x.add(q):q()),f=(x,q)=>{let z=Y;Y=q,x(),Y=z};class p{x;watchers=new Set;constructor(x){this.value=x}get(){return R(this.watchers),this.value}set(x){let q=m(x)?x(this.value):x;if(Object.is(this.value,q))return;this.value=q,P(this.watchers)}map(x){return b(()=>x(this.get()))}}var c=(x)=>new p(x),F=U(p);var Q=(x)=>typeof x==="function";var I=(x)=>(q)=>q instanceof x,E=(x)=>I(Error)(x),W=function(){return this};var X=(x)=>x==null?K():a(x)?x:Z(x),a=(x)=>C(x)||S(x);class A{static instance=new A;get=()=>{return}}var $=A.prototype;$.map=$.chain=$.filter=$.guard=$.catch=W;$.or=(x)=>X(x());$.match=function(x){return Q(x.Nil)?x.Nil():this};var K=()=>A.instance,S=(x)=>x===A.instance;class M{x;constructor(x){this.value=x}get(){return this.value}}var j=M.prototype;j.map=function(x){return new M(x(this.value))};j.chain=function(x){return x(this.value)};j.filter=j.guard=function(x){return x(this.value)?this:K()};j.or=j.catch=W;j.match=function(x){return Q(x.Ok)?x.Ok(this.value):this};var Z=(x)=>new M(x),C=I(M);class G{x;constructor(x){this.error=x}get(){throw this.error}}var V=G.prototype;V.map=V.chain=W;V.filter=V.guard=()=>K();V.or=(x)=>X(x());V.catch=function(x){return x(this.error)};V.match=function(x){return Q(x.Err)?x.Err(this.error):this};var O=(x)=>new G(E(x)?x:new Error(String(x))),L=I(G);var o=(x,...q)=>{try{return e(x(...q))}catch(z){return O(z)}};var T=(x)=>C(x)||S(x)||L(x),e=(x)=>x==null?K():T(x)?x:E(x)?O(x):Z(x);var k=(x)=>typeof x==="function",n=(x)=>typeof x==="object",v=(x)=>!!x&&n(x);var _=(x)=>typeof x==="string";var jx="debug";var Vx="warn",y="error",Wx=(x)=>x?`#${x}`:"",Ax=(x)=>x.length?`.${Array.from(x).join(".")}`:"",xx=(x)=>`<${x.localName}${Wx(x.id)}${Ax(x.classList)}>`,qx=(x)=>_(x)?`"${x}"`:n(x)?JSON.stringify(x):x!=null?String(x):"undefined",d=(x,q,z=jx)=>{if(process.env.DEV_MODE==="true"||[y,Vx].includes(z))console[z](q,x);return x};var Mx="UI",g=(x,q=x)=>({[Symbol.toStringTag]:Mx,host:x,target:q});var zx=(x)=>(q)=>X(x.root.querySelector(q)).map((z)=>g(x,z)),Bx=(x)=>(q)=>Array.from(x.root.querySelectorAll(q)).map((z)=>g(x,z));var Yx=(x)=>k(x)&&!!x.length,Hx=(x,q,z,B=void 0)=>{let J=x.constructor.states[q];return Yx(J)?J(x,z,B):z};class Jx extends HTMLElement{static registry=customElements;static states={};static observedAttributes=[];static define(x){o(()=>Jx.registry.define(x,this)).match({Err:(q)=>d(x,q.message,y),Ok:()=>!1})}signals=new Map;internals;self=Z(g(this));root=this.shadowRoot||this;debug=!1;attributeChangedCallback(x,q,z){if(z===q)return;this.set(x,Hx(this,x,z,q))}connectedCallback(){if(_(this.getAttribute("debug")))this.debug=!0}disconnectedCallback(){}adoptedCallback(){}has(x){return this.signals.has(x)}get(x){let q=(B)=>!v(B)?B:k(B)?q(B()):D(B)||T(B)?q(B.get()):B;return q(this.signals.get(x))}set(x,q,z=!0){if(L(q)){d(q.error,`Unhandled error before trying to set state '${x}' in <${this.localName}>`,y);return}let B=T(q)?q.get():q;if(!this.signals.has(x))this.signals.set(x,D(B)?B:c(B));else if(z){let J=this.signals.get(x);if(D(B))this.signals.set(x,B);else if(F(J))J.set(B);else d(B,`Computed state ${qx(x)} in ${xx(this)} cannot be set`,y)}}delete(x){return this.signals.delete(x)}first=zx(this);all=Bx(this)}export{Jx as Capsula};
