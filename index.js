var K$=($)=>typeof $==="function",D$=($)=>K$($)&&/^async\s+/.test($.toString()),c=($)=>(B)=>B instanceof $,i=c(Error),H$=c(Promise);var j$="Computed",M=($,B)=>{B=B??D$($);let K=new Set,Z,z=null,V=!0,J=()=>{if(V=!0,B)v(K)},D=()=>{try{return $(Z)}catch(A){return i(A)?A:new Error(`Error during reactive computation: ${A}`)}},Q=(A)=>{V=!1,Z=A,z=null},Y$=(A)=>{V=!0,z=A},Q$=(A)=>i(A)?Y$(A):Q(A),X$={[Symbol.toStringTag]:j$,get:()=>{if(o(K),!B||V)n(()=>{let A=D();H$(A)?A.then(Q$).catch(Y$):Q$(A)},J);if(i(z))throw z;return Z},map:(A)=>M(()=>A(X$.get()))};return X$},Z$=($)=>!!$&&typeof $==="object"&&$[Symbol.toStringTag]===j$;var _,z$=!1,V$=new Set,C=($)=>U($)||Z$($),o=($)=>{if(_)$.add(_)},v=($)=>$.forEach((B)=>z$?V$.add(B):B()),n=($,B)=>{let K=_;_=B,$(),_=K},_$=($)=>{z$=!0,$(),z$=!1,V$.forEach((B)=>B()),V$.clear()};var E=Symbol();class s{$;watchers=new Set;constructor($){this.value=$}get(){return o(this.watchers),this.value}set($){if(E!==$){let B=K$($)?$(this.value):$;if(Object.is(this.value,B))return;this.value=B}if(v(this.watchers),E===$)this.watchers.clear()}map($){return M(()=>$(this.get()))}}var A$=($)=>new s($),U=c(s);var r=($)=>{let B=()=>n(()=>{try{$()}catch(K){console.error(K)}},B);B()};var H=($)=>typeof $==="function";var k=($)=>(B)=>B instanceof $,u=($)=>k(Error)($),q=function(){return this};var j=($)=>$==null?X():x$($)?$:g($),x$=($)=>S($)||N($);class P{static instance=new P;get=()=>{return}}var I=P.prototype;I.map=I.chain=I.filter=I.guard=I.catch=q;I.or=($)=>j($());I.match=function($){return H($.Nil)?$.Nil():this};var X=()=>P.instance,N=($)=>$===P.instance;class T{$;constructor($){this.value=$}get(){return this.value}}var w=T.prototype;w.map=function($){return new T($(this.value))};w.chain=function($){return $(this.value)};w.filter=w.guard=function($){return $(this.value)?this:X()};w.or=w.catch=q;w.match=function($){return H($.Ok)?$.Ok(this.value):this};var g=($)=>new T($),S=k(T);class f{$;constructor($){this.error=$}get(){throw this.error}}var L=f.prototype;L.map=L.chain=q;L.filter=L.guard=()=>X();L.or=($)=>j($());L.catch=function($){return $(this.error)};L.match=function($){return H($.Err)?$.Err(this.error):this};var y=($)=>new f(u($)?$:new Error(String($))),h=k(f);var R=($,...B)=>{try{return a($(...B))}catch(K){return y(K)}},M$=async($,...B)=>{try{return a(await $(...B))}catch(K){return y(K)}},E$=async(...$)=>{let B=H($[0])?X():a($.shift());for(let K of $){if(h(B))break;if(!H(K))return y(new TypeError("Expected a function in flow"));B=/^async\s+/.test(K.toString())?await M$(async()=>K(B.get())):R(K,B.get())}return B},l=($)=>S($)||N($)||h($),a=($)=>$==null?X():l($)?$:u($)?y($):g($),k$=($)=>h($)?$.error:S($)||N($)?$.get():$;var W=($)=>typeof $==="function",t=($)=>!!$&&typeof $==="object",g$=($)=>typeof $==="number",O=($)=>typeof $==="string",f$=($)=>typeof $==="symbol",G$=($)=>O($)||f$($)||g$($);var h$="debug";var d$="warn",x="error",p$=($)=>$?`#${$}`:"",m$=($)=>$.length?`.${Array.from($).join(".")}`:"",F$=($)=>`<${$.localName}${p$($.id)}${m$($.classList)}>`,e=($)=>O($)?`"${$}"`:t($)?JSON.stringify($):String($),G=($,B,K=h$)=>{if([x,d$].includes(K))console[K](B,$);return $};var c$=($,B)=>{return G$(B)?$.signals.get(B):C(B)?B:W(B)?M(B.bind($),!0):void 0};class d{$;B;constructor($,B=[$]){this.host=$;this.targets=B}on($,B){return this.targets.forEach((K)=>K.addEventListener($,B)),this}off($,B){return this.targets.forEach((K)=>K.removeEventListener($,B)),this}pass($){return this.targets.forEach(async(B)=>{if(await b.registry.whenDefined(B.localName),B instanceof b)Object.entries($).forEach(([K,Z])=>{let z=c$(this.host,Z);if(z)B.set(K,z);else G(Z,`Invalid source for state ${e(K)}`,x)});else G(B,"Target is not a Capsula",x)}),this}sync(...$){return this.targets.forEach((B,K)=>$.forEach((Z)=>Z(this.host,B,K))),this}}var p=($,B,K,Z=void 0)=>{let z=$.constructor.states[B];return W(z)&&!!z.length?z(K,$,Z):K},sB=($)=>$!=null,rB=($)=>j($).map(parseInt).filter(Number.isFinite).get(),uB=($)=>j($).map(parseFloat).filter(Number.isFinite).get(),lB=($)=>$,aB=($)=>(B)=>j(B).filter((K)=>$.includes(K.toLowerCase())).get(),tB=($)=>R(()=>$?JSON.parse($):null).match({Err:(B)=>{G(B,"Failed to parse JSON",x);return}}).get();var C$="context-request";class I$ extends Event{$;B;K;constructor($,B,K=!1){super(C$,{bubbles:!0,composed:!0});this.context=$;this.callback=B;this.subscribe=K}}var J$=($)=>{let B=$.constructor,K=B.consumedContexts||[];setTimeout(()=>{for(let z of K)$.dispatchEvent(new I$(z,(V)=>$.set(String(z),V)))});let Z=B.providedContexts||[];if(!Z.length)return!1;return $.addEventListener(C$,(z)=>{let{context:V,callback:J}=z;if(!Z.includes(V)||!W(J))return;z.stopPropagation(),J($.signals.get(String(V)))}),!0};class b extends HTMLElement{static registry=customElements;static states={};static observedAttributes;static consumedContexts;static providedContexts;static define($){R(()=>b.registry.define($,this)).match({Err:(B)=>G($,B.message,x),Ok:()=>!1})}signals=new Map;self=new d(this);root=this.shadowRoot||this;debug=!1;attributeChangedCallback($,B,K){if(K===B)return;this.set($,p(this,$,K,B))}connectedCallback(){Object.entries(this.constructor.states).forEach(([$,B])=>{let K=W(B)?p(this,$,this.getAttribute($)??void 0,void 0):B;this.set($,K,!1)}),J$(this)}disconnectedCallback(){}adoptedCallback(){}has($){return this.signals.has($)}get($){let B=(Z)=>!t(Z)?Z:W(Z)?B(Z()):C(Z)||l(Z)?B(Z.get()):Z;return B(this.signals.get($))}set($,B,K=!0){let Z;if(!this.signals.has($))Z="Create",this.signals.set($,C(B)?B:W(B)?M(B,!0):A$(B));else if(!K)return;else{let z=this.signals.get($);if(C(B)){if(Z="Replace",this.signals.set($,B),U(z))z.set(E)}else if(U(z))Z="Update",z.set(B);else{G(B,`Computed state ${e($)} in ${F$(this)} cannot be set`,x);return}}}delete($){return this.signals.delete($)}first($){let B=this.root.querySelector($);return new d(this,B?[B]:[])}all($){return new d(this,Array.from(this.root.querySelectorAll($)))}}if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=($)=>setTimeout($,16);var $$=new Map,m=[],B$,w$=()=>{B$=null,m.forEach(($)=>$()),m=[],$$.clear()},i$=()=>{if(B$)cancelAnimationFrame(B$);B$=requestAnimationFrame(w$)};queueMicrotask(w$);var Y=($,B)=>new Promise((K,Z)=>{let z=()=>{try{K($())}catch(V){Z(V)}};if(B){let[V,J]=B;if(!$$.has(V))$$.set(V,new Map);let D=$$.get(V);if(D.has(J)){let Q=m.indexOf($);if(Q>-1)m.splice(Q,1)}D.set(J,z)}m.push(z),i$()}),L$=async()=>new Promise(requestAnimationFrame);var U$=($)=>$.nodeType===Node.COMMENT_NODE,o$=($)=>!/^on/i.test($),v$=($)=>{if(/^(mailto|tel):/i.test($))return!0;if($.includes("://"))try{let B=new URL($,window.location.origin);return!["http:","https:","ftp:"].includes(B.protocol)}catch(B){return!0}return!0},W$=($,B,K)=>{if(!o$(B))throw new Error(`Unsafe attribute: ${B}`);if(K=String(K).trim(),!v$(K))throw new Error(`Unsafe URL for ${B}: ${K}`);$.setAttribute(B,K)};var q$=($,B,K={},Z)=>Y(()=>{let z=document.createElement(B);for(let[V,J]of Object.entries(K))W$(z,V,J);if(Z)z.textContent=Z;return $.append(z),z},[$,"e"]),N$=($)=>Y(()=>{return $.remove(),null},[$,"r"]),S$=($,B)=>Y(()=>{return Array.from($.childNodes).filter((K)=>!U$(K)).forEach((K)=>K.remove()),$.append(document.createTextNode(B)),$},[$,"t"]),P$=($,B,K)=>Y(()=>{return W$($,B,K),$},[$,`a:${B}`]),T$=($,B)=>Y(()=>{return $.removeAttribute(B),$},[$,`a:${B}`]),y$=($,B,K)=>Y(()=>{return $.toggleAttribute(B,K),$},[$,`a:${B}`]),R$=($,B,K)=>Y(()=>{return $.classList.toggle(B,K),$},[$,`c:${B}`]),O$=($,B,K)=>Y(()=>{return $.style.setProperty(B,K),$},[$,`s:${B}`]),b$=($,B)=>Y(()=>{return $.style.removeProperty(B),$},[$,`s:${B}`]);var L5=($,B=$)=>(K,Z)=>r(()=>{Z.dispatchEvent(new CustomEvent($,{detail:K.get(B),bubbles:!0}))}),F=($,B)=>(K,Z)=>{let{read:z,update:V}=B,J=z(Z);if(!W($)){let D=O($)&&O(J)?p(K,$,J):J;K.set($,D,!1)}r(()=>{let D=z(Z),Q=W($)?$(D):K.get($);if(!Object.is(Q,D)){if(Q===null&&B.delete)B.delete(Z);else if(Q==null&&J)V(Z,J);else if(Q!=null)V(Z,Q)}})},U5=($,B)=>F(B,{read:()=>null,update:(K,Z)=>q$(K,$,Z)}),q5=($)=>F($,{read:(B)=>B!=null,update:(B,K)=>K?N$(B):Promise.resolve(null)}),N5=($)=>F($,{read:(B)=>B.textContent,update:(B,K)=>S$(B,K)}),S5=($,B=$)=>F(B,{read:(K)=>K[$],update:(K,Z)=>K[$]=Z}),P5=($,B=$)=>F(B,{read:(K)=>K.getAttribute($),update:(K,Z)=>P$(K,$,Z),delete:(K)=>T$(K,$)}),T5=($,B=$)=>F(B,{read:(K)=>K.hasAttribute($),update:(K,Z)=>y$(K,$,Z)}),y5=($,B=$)=>F(B,{read:(K)=>K.classList.contains($),update:(K,Z)=>R$(K,$,Z)}),R5=($,B=$)=>F(B,{read:(K)=>K.style.getPropertyValue($),update:(K,Z)=>O$(K,$,Z),delete:(K)=>b$(K,$)});export{J$ as useContext,F as updateElement,y5 as toggleClass,T5 as toggleAttribute,a as toResult,A$ as state,N5 as setText,R5 as setStyle,S5 as setProperty,P5 as setAttribute,R as result,q5 as removeElement,p as parse,g as ok,X as nil,j as maybe,U as isState,C as isSignal,l as isResult,S as isOk,N as isNil,x$ as isMaybe,h as isErr,Z$ as isComputed,k$ as fromResult,E$ as flow,y as err,Y as enqueue,L5 as emit,r as effect,U5 as createElement,M as computed,_$ as batch,M$ as asyncResult,lB as asString,uB as asNumber,tB as asJSON,rB as asInteger,aB as asEnum,sB as asBoolean,L$ as animationFrame,E as UNSET,s as State,T as Ok,P as Nil,f as Err,b as Capsula};
