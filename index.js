var F=($)=>typeof $==="function",v=($)=>F($)&&/^async\s+/.test($.toString()),q=($)=>(A)=>A instanceof $,g=q(Error),s=q(Promise);var n="Computed",N=($,A)=>{A=A??v($);let B=[],z,K=null,Z=!0,V=()=>{if(Z=!0,A)T(B)},j={[Symbol.toStringTag]:n,get:()=>{if(A)O(B);if(!A||Z)R(()=>{let W=(Y)=>{z=Y,Z=!1,K=null},r=(Y)=>{K=g(Y)?Y:new Error(`Computed function failed: ${Y}`)};try{let Y=$(z);s(Y)?Y.then(W).catch(r):W(Y)}catch(Y){r(Y)}},V);if(g(K))throw K;return z},map:(W)=>N(()=>W(j.get()))};return j},o=($)=>!!$&&typeof $==="object"&&$[Symbol.toStringTag]===n;var w,p=!1,d=[],y=($)=>P($)||o($),M=($,A=!1)=>y($)?$:F($)?N($,A):E($),O=($)=>{if(w&&!$.includes(w))$.push(w)},T=($)=>$.forEach((A)=>p?d.push(A):A()),R=($,A)=>{let B=w;w=A,$(),w=B},u=($)=>{p=!0,$(),p=!1,d.forEach((A)=>A()),d.length=0};var C=Symbol();class b{$;watchers=[];constructor($){this.value=$}get(){return O(this.watchers),this.value}set($){if(C!==$){let A=F($)?$(this.value):$;if(Object.is(this.value,A))return;this.value=A}if(T(this.watchers),C===$)this.watchers=[]}map($){return N(()=>$(this.get()))}}var E=($)=>new b($),P=q(b);var S=($)=>{let A=()=>R(()=>{try{$()}catch(B){console.error(B)}},A);A()};if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=($)=>setTimeout($,16);var f=new Map,x=[],k,l=()=>{k=null,x.forEach(($)=>$()),x=[],f.clear()},N$=()=>{if(k)cancelAnimationFrame(k);k=requestAnimationFrame(l)};queueMicrotask(l);var D=($,A)=>new Promise((B,z)=>{let K=()=>{try{B($())}catch(Z){z(Z)}};if(A){let[Z,V]=A;if(!f.has(Z))f.set(Z,new Map);let j=f.get(Z);if(j.has(V)){let W=x.indexOf($);if(W>-1)x.splice(W,1)}j.set(V,K)}x.push(K),N$()}),t=async()=>new Promise(requestAnimationFrame);var a=($)=>$.nodeType===Node.COMMENT_NODE,P$=($)=>!/^on/i.test($),w$=($)=>{if(/^(mailto|tel):/i.test($))return!0;if($.includes("://"))try{let A=new URL($,window.location.origin);return!["http:","https:","ftp:"].includes(A.protocol)}catch(A){return!0}return!0},i=($,A,B)=>{if(!P$(A))throw new Error(`Unsafe attribute: ${A}`);if(B=String(B).trim(),!w$(B))throw new Error(`Unsafe URL for ${A}: ${B}`);$.setAttribute(A,B)};var e=($,A,B={},z)=>D(()=>{let K=document.createElement(A);for(let[Z,V]of Object.entries(B))i(K,Z,V);if(z)K.textContent=z;return $.append(K),K},[$,"e"]),$$=($)=>D(()=>{return $.remove(),null},[$,"r"]),A$=($,A)=>D(()=>{return Array.from($.childNodes).filter((B)=>!a(B)).forEach((B)=>B.remove()),$.append(document.createTextNode(A)),$},[$,"t"]),B$=($,A,B)=>D(()=>{return i($,A,B),$},[$,`a:${A}`]),z$=($,A)=>D(()=>{return $.removeAttribute(A),$},[$,`a:${A}`]),K$=($,A,B)=>D(()=>{return $.toggleAttribute(A,B),$},[$,`a:${A}`]),Z$=($,A,B)=>D(()=>{return $.classList.toggle(A,B),$},[$,`c:${A}`]),V$=($,A,B)=>D(()=>{return $.style.setProperty(A,B),$},[$,`s:${A}`]),W$=($,A)=>D(()=>{return $.style.removeProperty(A),$},[$,`s:${A}`]);var J=($)=>typeof $==="function",_=($)=>!!$&&typeof $==="object",y$=($)=>typeof $==="number",G=($)=>typeof $==="string",M$=($)=>typeof $==="symbol",D$=($)=>G($)||M$($)||y$($);var J$="debug",C$="info",Y$="warn",Q="error",G$=($)=>$?`#${$}`:"",L$=($)=>$.length?`.${Array.from($).join(".")}`:"",j$=($)=>`<${$.localName}${G$($.id)}${L$($.classList)}>`,h=($)=>G($)?`"${$}"`:_($)?JSON.stringify($):String($),X=($,A,B=J$)=>{if([Q,Y$].includes(B))console[B](A,$);return $};var I$=($)=>J($)&&$.length===2,c=($,A,B=0)=>I$($)?$(A,B):$;class I{$;A;constructor($,A=[$]){this.host=$;this.targets=A}on($,A){return this.targets.forEach((B,z)=>B.addEventListener($,c(A,B,z))),this}off($,A){return this.targets.forEach((B,z)=>B.removeEventListener($,c(A,B,z))),this}pass($){return this.targets.forEach(async(A,B)=>{await L.registry.whenDefined(A.localName),A instanceof L?Object.entries($).forEach(([z,K])=>{let Z=c(K,A,B),V=D$(Z)?this.host.signals.get(Z):M(Z,!0);V?A.set(z,V):X(K,`Invalid source for state ${h(z)}`,Q)}):X(A,"Target is not a Capsula",Q)}),this}sync(...$){return this.targets.forEach((A,B)=>$.forEach((z)=>z(this.host,A,B))),this}}var Q$=($,A)=>{if(A==null)return;let B=$(A);return Number.isFinite(B)?B:void 0},U=($,A,B,z=void 0)=>{let K=$.constructor.states[A];return J(K)&&!!K.length?K(B,$,z):B},U$=($)=>$!=null,F$=($)=>Q$(parseInt,$),S$=($)=>Q$(parseFloat,$),x$=($)=>$,q$=($)=>(A)=>{if(A==null)return;return $.includes(A.toLowerCase())?A:void 0},O$=($)=>{if($==null)return;try{return JSON.parse($)}catch(A){X(A,"Failed to parse JSON",Q);return}};var X$="context-request";class H$ extends Event{$;A;B;constructor($,A,B=!1){super(X$,{bubbles:!0,composed:!0});this.context=$;this.callback=A;this.subscribe=B}}var m=($)=>{let A=$.constructor,B=A.consumedContexts||[];setTimeout(()=>{for(let K of B)$.dispatchEvent(new H$(K,(Z)=>$.set(String(K),Z)))});let z=A.providedContexts||[];if(!z.length)return!1;return $.addEventListener(X$,(K)=>{let{context:Z,callback:V}=K;if(!z.includes(Z)||!J(V))return;K.stopPropagation(),V($.signals.get(String(Z)))}),!0};class L extends HTMLElement{static registry=customElements;static states={};static observedAttributes;static consumedContexts;static providedContexts;static define($){try{L.registry.define($,this)}catch(A){X(A,`Failed to register custom element ${$}`,Q)}}signals=new Map;self=new I(this);root=this.shadowRoot||this;debug=!1;attributeChangedCallback($,A,B){if(B===A)return;this.set($,U(this,$,B,A))}connectedCallback(){Object.entries(this.constructor.states).forEach(([$,A])=>{let B=J(A)?U(this,$,this.getAttribute($)??void 0,void 0):A;this.set($,B,!1)}),m(this)}disconnectedCallback(){}adoptedCallback(){}has($){return this.signals.has($)}get($){let A=(z)=>!_(z)?z:J(z)?A(z()):y(z)?A(z.get()):z;return A(this.signals.get($))}set($,A,B=!0){let z;if(!this.signals.has($))this.signals.set($,M(A,!0));else if(B){let K=this.signals.get($);if(y(A)){if(this.signals.set($,A),P(K))K.set(C)}else if(P(K))K.set(A);else{X(A,`Computed state ${h($)} in ${j$(this)} cannot be set`,Q);return}}else return}delete($){return this.signals.delete($)}first($){let A=this.root.querySelector($);return new I(this,A?[A]:[])}all($){return new I(this,Array.from(this.root.querySelectorAll($)))}}var T$=($,A=$)=>(B,z)=>S(()=>{z.dispatchEvent(new CustomEvent($,{detail:B.get(A),bubbles:!0}))}),H=($,A)=>(B,z)=>{let{read:K,update:Z}=A,V=K(z);if(!J($)){let j=G($)&&G(V)?U(B,$,V):V;B.set($,j,!1)}S(()=>{let j=K(z),W=J($)?$(j):B.get($);if(!Object.is(W,j)){if(W===null&&A.delete)A.delete(z);else if(W==null&&V)Z(z,V);else if(W!=null)Z(z,W)}})},R$=($,A)=>H(A,{read:()=>null,update:(B,z)=>e(B,$,z)}),E$=($)=>H($,{read:(A)=>A!=null,update:(A,B)=>B?$$(A):Promise.resolve(null)}),b$=($)=>H($,{read:(A)=>A.textContent,update:(A,B)=>A$(A,B)}),f$=($,A=$)=>H(A,{read:(B)=>B[$],update:(B,z)=>B[$]=z}),k$=($,A=$)=>H(A,{read:(B)=>B.getAttribute($),update:(B,z)=>B$(B,$,z),delete:(B)=>z$(B,$)}),_$=($,A=$)=>H(A,{read:(B)=>B.hasAttribute($),update:(B,z)=>K$(B,$,z)}),h$=($,A=$)=>H(A,{read:(B)=>B.classList.contains($),update:(B,z)=>Z$(B,$,z)}),g$=($,A=$)=>H(A,{read:(B)=>B.style.getPropertyValue($),update:(B,z)=>V$(B,$,z),delete:(B)=>W$(B,$)});export{m as useContext,H as updateElement,h$ as toggleClass,_$ as toggleAttribute,M as toSignal,E as state,b$ as setText,g$ as setStyle,f$ as setProperty,k$ as setAttribute,E$ as removeElement,U as parse,X as log,P as isState,y as isSignal,D as enqueue,T$ as emit,S as effect,R$ as createElement,N as computed,u as batch,x$ as asString,S$ as asNumber,O$ as asJSON,F$ as asInteger,q$ as asEnum,U$ as asBoolean,t as animationFrame,C as UNSET,I as UI,Y$ as LOG_WARN,C$ as LOG_INFO,Q as LOG_ERROR,J$ as LOG_DEBUG,L as Capsula};
