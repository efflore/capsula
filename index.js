var L=(y)=>typeof y==="function",s=(y)=>L(y)&&/^async\s+/.test(y.toString()),T=(y)=>($)=>$ instanceof y,g=T(Error),m=T(Promise);var n="Computed",X=(y,$)=>{$=$??s(y);let K=[],A,j=null,z=!0,B=()=>{if(z=!0,$)O(K)},D={[Symbol.toStringTag]:n,get:()=>{if($)G(K);if(!$||z)E(()=>{let P=(V)=>{A=V,z=!1,j=null},r=(V)=>{j=g(V)?V:new Error(`Computed function failed: ${V}`)};try{let V=y(A);m(V)?V.then(P).catch(r):P(V)}catch(V){r(V)}},B);if(g(j))throw j;return A},map:(P)=>X(()=>P(D.get()))};return D},h=(y)=>!!y&&typeof y==="object"&&y[Symbol.toStringTag]===n;var x,o=!1,d=[],C=(y)=>f(y)||h(y),H=(y,$=!1)=>C(y)?y:L(y)?X(y,$):q(y),G=(y)=>{if(x&&!y.includes(x))y.push(x)},O=(y)=>y.forEach(($)=>o?d.push($):$()),E=(y,$)=>{let K=x;x=$,y(),x=K},v=(y)=>{o=!0,y(),o=!1,d.forEach(($)=>$()),d.length=0};var w=Symbol();class R{y;watchers=[];constructor(y){this.value=y}get(){return G(this.watchers),this.value}set(y){if(w!==y){let $=L(y)?y(this.value):y;if(Object.is(this.value,$))return;this.value=$}if(O(this.watchers),w===y)this.watchers=[]}map(y){return X(()=>y(this.get()))}}var q=(y)=>new R(y),f=T(R);var S=(y)=>{let $=()=>E(()=>{try{y()}catch(K){console.error(K)}},$);$()};if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=(y)=>setTimeout(y,16);var b=new Map,F=[],_,u=()=>{_=null,F.forEach((y)=>y()),F=[],b.clear()},Wy=()=>{if(_)cancelAnimationFrame(_);_=requestAnimationFrame(u)};queueMicrotask(u);var Z=(y,$)=>new Promise((K,A)=>{let j=()=>{try{K(y())}catch(z){A(z)}};if($){let[z,B]=$;if(!b.has(z))b.set(z,new Map);let D=b.get(z);if(D.has(B)){let P=F.indexOf(y);if(P>-1)F.splice(P,1)}D.set(B,j)}F.push(j),Wy()}),t=async()=>new Promise(requestAnimationFrame);var a=(y)=>y.nodeType===Node.COMMENT_NODE,Yy=(y)=>!/^on/i.test(y),Qy=(y)=>{if(/^(mailto|tel):/i.test(y))return!0;if(y.includes("://"))try{let $=new URL(y,window.location.origin);return!["http:","https:","ftp:"].includes($.protocol)}catch($){return!0}return!0},p=(y,$,K)=>{if(!Yy($))throw new Error(`Unsafe attribute: ${$}`);if(K=String(K).trim(),!Qy(K))throw new Error(`Unsafe URL for ${$}: ${K}`);y.setAttribute($,K)};var l=(y,$,K={},A)=>Z(()=>{let j=document.createElement($);for(let[z,B]of Object.entries(K))p(j,z,B);if(A)j.textContent=A;return y.append(j),j},[y,"e"]),e=(y)=>Z(()=>{return y.remove(),null},[y,"r"]),yy=(y,$)=>Z(()=>{return Array.from(y.childNodes).filter((K)=>!a(K)).forEach((K)=>K.remove()),y.append(document.createTextNode($)),y},[y,"t"]),$y=(y,$,K)=>Z(()=>{return p(y,$,K),y},[y,`a:${$}`]),Ky=(y,$)=>Z(()=>{return y.removeAttribute($),y},[y,`a:${$}`]),Ay=(y,$,K)=>Z(()=>{return y.toggleAttribute($,K),y},[y,`a:${$}`]),jy=(y,$,K)=>Z(()=>{return y.classList.toggle($,K),y},[y,`c:${$}`]),zy=(y,$,K)=>Z(()=>{return y.style.setProperty($,K),y},[y,`s:${$}`]),By=(y,$)=>Z(()=>{return y.style.removeProperty($),y},[y,`s:${$}`]);var J=(y)=>typeof y==="function",i=(y)=>!!y&&typeof y==="object",Xy=(y)=>typeof y==="number",I=(y)=>typeof y==="string",fy=(y)=>typeof y==="symbol",Py=(y)=>I(y)||fy(y)||Xy(y);var xy="debug";var Cy="warn",W="error",Hy=(y)=>y?`#${y}`:"",wy=(y)=>y.length?`.${Array.from(y).join(".")}`:"",Zy=(y)=>`<${y.localName}${Hy(y.id)}${wy(y.classList)}>`,k=(y)=>I(y)?`"${y}"`:i(y)?JSON.stringify(y):String(y),Q=(y,$,K=xy)=>{if([W,Cy].includes(K))console[K]($,y);return y};class M{y;$;constructor(y,$=[y]){this.host=y;this.targets=$}on(y,$){return this.targets.forEach((K)=>K.addEventListener(y,$)),this}off(y,$){return this.targets.forEach((K)=>K.removeEventListener(y,$)),this}pass(y){return this.targets.forEach(async($)=>{if(await N.registry.whenDefined($.localName),$ instanceof N)Object.entries(y).forEach(([K,A])=>{let j=Py(A)?this.host.signals.get(A):H(A,!0);if(j)$.set(K,j);else Q(A,`Invalid source for state ${k(K)}`,W)});else Q($,"Target is not a Capsula",W)}),this}sync(...y){return this.targets.forEach(($,K)=>y.forEach((A)=>A(this.host,$,K))),this}}var Vy=(y,$)=>{if($==null)return;let K=y($);return Number.isFinite(K)?K:void 0},U=(y,$,K,A=void 0)=>{let j=y.constructor.states[$];return J(j)&&!!j.length?j(K,y,A):K},Iy=(y)=>y!=null,Ny=(y)=>Vy(parseInt,y),Uy=(y)=>Vy(parseFloat,y),Ly=(y)=>y,Sy=(y)=>($)=>{if($==null)return;return y.includes($.toLowerCase())?$:void 0},Fy=(y)=>{if(y==null)return;try{return JSON.parse(y)}catch($){Q($,"Failed to parse JSON",W);return}};var Dy="context-request";class Jy extends Event{y;$;K;constructor(y,$,K=!1){super(Dy,{bubbles:!0,composed:!0});this.context=y;this.callback=$;this.subscribe=K}}var c=(y)=>{let $=y.constructor,K=$.consumedContexts||[];setTimeout(()=>{for(let j of K)y.dispatchEvent(new Jy(j,(z)=>y.set(String(j),z)))});let A=$.providedContexts||[];if(!A.length)return!1;return y.addEventListener(Dy,(j)=>{let{context:z,callback:B}=j;if(!A.includes(z)||!J(B))return;j.stopPropagation(),B(y.signals.get(String(z)))}),!0};class N extends HTMLElement{static registry=customElements;static states={};static observedAttributes;static consumedContexts;static providedContexts;static define(y){try{N.registry.define(y,this)}catch($){Q($,`Failed to register custom element ${y}`,W)}}signals=new Map;self=new M(this);root=this.shadowRoot||this;debug=!1;attributeChangedCallback(y,$,K){if(K===$)return;this.set(y,U(this,y,K,$))}connectedCallback(){Object.entries(this.constructor.states).forEach(([y,$])=>{let K=J($)?U(this,y,this.getAttribute(y)??void 0,void 0):$;this.set(y,K,!1)}),c(this)}disconnectedCallback(){}adoptedCallback(){}has(y){return this.signals.has(y)}get(y){let $=(A)=>!i(A)?A:J(A)?$(A()):C(A)?$(A.get()):A;return $(this.signals.get(y))}set(y,$,K=!0){let A;if(!this.signals.has(y))this.signals.set(y,H($,!0));else if(K){let j=this.signals.get(y);if(C($)){if(this.signals.set(y,$),f(j))j.set(w)}else if(f(j))j.set($);else{Q($,`Computed state ${k(y)} in ${Zy(this)} cannot be set`,W);return}}else return}delete(y){return this.signals.delete(y)}first(y){let $=this.root.querySelector(y);return new M(this,$?[$]:[])}all(y){return new M(this,Array.from(this.root.querySelectorAll(y)))}}var My=(y,$=y)=>(K,A)=>S(()=>{A.dispatchEvent(new CustomEvent(y,{detail:K.get($),bubbles:!0}))}),Y=(y,$)=>(K,A)=>{let{read:j,update:z}=$,B=j(A);if(!J(y)){let D=I(y)&&I(B)?U(K,y,B):B;K.set(y,D,!1)}S(()=>{let D=j(A),P=J(y)?y(D):K.get(y);if(!Object.is(P,D)){if(P===null&&$.delete)$.delete(A);else if(P==null&&B)z(A,B);else if(P!=null)z(A,P)}})},Ty=(y,$)=>Y($,{read:()=>null,update:(K,A)=>l(K,y,A)}),Gy=(y)=>Y(y,{read:($)=>$!=null,update:($,K)=>K?e($):Promise.resolve(null)}),Oy=(y)=>Y(y,{read:($)=>$.textContent,update:($,K)=>yy($,K)}),Ey=(y,$=y)=>Y($,{read:(K)=>K[y],update:(K,A)=>K[y]=A}),qy=(y,$=y)=>Y($,{read:(K)=>K.getAttribute(y),update:(K,A)=>$y(K,y,A),delete:(K)=>Ky(K,y)}),Ry=(y,$=y)=>Y($,{read:(K)=>K.hasAttribute(y),update:(K,A)=>Ay(K,y,A)}),by=(y,$=y)=>Y($,{read:(K)=>K.classList.contains(y),update:(K,A)=>jy(K,y,A)}),_y=(y,$=y)=>Y($,{read:(K)=>K.style.getPropertyValue(y),update:(K,A)=>zy(K,y,A),delete:(K)=>By(K,y)});export{c as useContext,Y as updateElement,by as toggleClass,Ry as toggleAttribute,H as toSignal,q as state,Oy as setText,_y as setStyle,Ey as setProperty,qy as setAttribute,Gy as removeElement,U as parse,f as isState,C as isSignal,Z as enqueue,My as emit,S as effect,Ty as createElement,X as computed,v as batch,Ly as asString,Uy as asNumber,Fy as asJSON,Ny as asInteger,Sy as asEnum,Iy as asBoolean,t as animationFrame,w as UNSET,N as Capsula};
