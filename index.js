var h=($)=>typeof $==="function",n=($)=>h($)&&/^async\s+/.test($.toString()),M=($)=>(K)=>K instanceof $,T=M(Error),v=M(Promise);var u="Computed",X=($,K)=>{K=K??n($);let A=new Set,B,j=null,y=!0,P=()=>{if(y=!0,K)G(A)},J=()=>{try{return $(B)}catch(z){return T(z)?z:new Error(`Error during reactive computation: ${z}`)}},D=(z)=>{y=!1,B=z,j=null},r=(z)=>{y=!0,j=z},s=(z)=>T(z)?r(z):D(z),m={[Symbol.toStringTag]:u,get:()=>{if(f(A),!K||y)O(()=>{let z=J();v(z)?z.then(s).catch(r):s(z)},P);if(T(j))throw j;return B},map:(z)=>X(()=>z(m.get()))};return m},i=($)=>!!$&&typeof $==="object"&&$[Symbol.toStringTag]===u;var U,o=!1,d=new Set,H=($)=>C($)||i($),f=($)=>{if(U)$.add(U)},G=($)=>$.forEach((K)=>o?d.add(K):K()),O=($,K)=>{let A=U;U=K,$(),U=A},t=($)=>{o=!0,$(),o=!1,d.forEach((K)=>K()),d.clear()};var x=Symbol();class q{$;watchers=new Set;constructor($){this.value=$}get(){return f(this.watchers),this.value}set($){if(x!==$){let K=h($)?$(this.value):$;if(Object.is(this.value,K))return;this.value=K}if(G(this.watchers),x===$)this.watchers.clear()}map($){return X(()=>$(this.get()))}}var E=($)=>new q($),C=M(q);var L=($)=>{let K=()=>O(()=>{try{$()}catch(A){console.error(A)}},K);K()};if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=($)=>setTimeout($,16);var R=new Map,S=[],b,a=()=>{b=null,S.forEach(($)=>$()),S=[],R.clear()},Q$=()=>{if(b)cancelAnimationFrame(b);b=requestAnimationFrame(a)};queueMicrotask(a);var Z=($,K)=>new Promise((A,B)=>{let j=()=>{try{A($())}catch(y){B(y)}};if(K){let[y,P]=K;if(!R.has(y))R.set(y,new Map);let J=R.get(y);if(J.has(P)){let D=S.indexOf($);if(D>-1)S.splice(D,1)}J.set(P,j)}S.push(j),Q$()}),l=async()=>new Promise(requestAnimationFrame);var e=($)=>$.nodeType===Node.COMMENT_NODE,X$=($)=>!/^on/i.test($),C$=($)=>{if(/^(mailto|tel):/i.test($))return!0;if($.includes("://"))try{let K=new URL($,window.location.origin);return!["http:","https:","ftp:"].includes(K.protocol)}catch(K){return!0}return!0},c=($,K,A)=>{if(!X$(K))throw new Error(`Unsafe attribute: ${K}`);if(A=String(A).trim(),!C$(A))throw new Error(`Unsafe URL for ${K}: ${A}`);$.setAttribute(K,A)};var $$=($,K,A={},B)=>Z(()=>{let j=document.createElement(K);for(let[y,P]of Object.entries(A))c(j,y,P);if(B)j.textContent=B;return $.append(j),j},[$,"e"]),K$=($)=>Z(()=>{return $.remove(),null},[$,"r"]),A$=($,K)=>Z(()=>{return Array.from($.childNodes).filter((A)=>!e(A)).forEach((A)=>A.remove()),$.append(document.createTextNode(K)),$},[$,"t"]),B$=($,K,A)=>Z(()=>{return c($,K,A),$},[$,`a:${K}`]),j$=($,K)=>Z(()=>{return $.removeAttribute(K),$},[$,`a:${K}`]),y$=($,K,A)=>Z(()=>{return $.toggleAttribute(K,A),$},[$,`a:${K}`]),z$=($,K,A)=>Z(()=>{return $.classList.toggle(K,A),$},[$,`c:${K}`]),P$=($,K,A)=>Z(()=>{return $.style.setProperty(K,A),$},[$,`s:${K}`]),Z$=($,K)=>Z(()=>{return $.style.removeProperty(K),$},[$,`s:${K}`]);var V=($)=>typeof $==="function",_=($)=>!!$&&typeof $==="object",H$=($)=>typeof $==="number",w=($)=>typeof $==="string",x$=($)=>typeof $==="symbol",V$=($)=>w($)||x$($)||H$($);var w$="debug";var I$="warn",W="error",N$=($)=>$?`#${$}`:"",U$=($)=>$.length?`.${Array.from($).join(".")}`:"",D$=($)=>`<${$.localName}${N$($.id)}${U$($.classList)}>`,k=($)=>w($)?`"${$}"`:_($)?JSON.stringify($):String($),Q=($,K,A=w$)=>{if([W,I$].includes(A))console[A](K,$);return $};class F{$;K;constructor($,K=[$]){this.host=$;this.targets=K}on($,K){return this.targets.forEach((A)=>A.addEventListener($,K)),this}off($,K){return this.targets.forEach((A)=>A.removeEventListener($,K)),this}pass($){return this.targets.forEach(async(K)=>{if(await I.registry.whenDefined(K.localName),K instanceof I)Object.entries($).forEach(([A,B])=>{let j=V$(B)?this.host.signals.get(B):g(B);if(j)K.set(A,j);else Q(B,`Invalid source for state ${k(A)}`,W)});else Q(K,"Target is not a Capsula",W)}),this}sync(...$){return this.targets.forEach((K,A)=>$.forEach((B)=>B(this.host,K,A))),this}}var J$=($,K)=>{if(K==null)return;let A=$(K);return Number.isFinite(A)?A:void 0},N=($,K,A,B=void 0)=>{let j=$.constructor.states[K];return V(j)&&!!j.length?j(A,$,B):A},L$=($)=>$!=null,S$=($)=>J$(parseInt,$),F$=($)=>J$(parseFloat,$),M$=($)=>$,T$=($)=>(K)=>{if(K==null)return;return $.includes(K.toLowerCase())?K:void 0},f$=($)=>{if($==null)return;try{return JSON.parse($)}catch(K){Q(K,"Failed to parse JSON",W);return}};var W$="context-request";class Y$ extends Event{$;K;A;constructor($,K,A=!1){super(W$,{bubbles:!0,composed:!0});this.context=$;this.callback=K;this.subscribe=A}}var p=($)=>{let K=$.constructor,A=K.consumedContexts||[];setTimeout(()=>{for(let j of A)$.dispatchEvent(new Y$(j,(y)=>$.set(String(j),y)))});let B=K.providedContexts||[];if(!B.length)return!1;return $.addEventListener(W$,(j)=>{let{context:y,callback:P}=j;if(!B.includes(y)||!V(P))return;j.stopPropagation(),P($.signals.get(String(y)))}),!0};var g=($)=>H($)?$:V($)?X($,!0):E($);class I extends HTMLElement{static registry=customElements;static states={};static observedAttributes;static consumedContexts;static providedContexts;static define($){try{I.registry.define($,this)}catch(K){Q(K,`Failed to register custom element ${$}`,W)}}signals=new Map;self=new F(this);root=this.shadowRoot||this;debug=!1;attributeChangedCallback($,K,A){if(A===K)return;this.set($,N(this,$,A,K))}connectedCallback(){Object.entries(this.constructor.states).forEach(([$,K])=>{let A=V(K)?N(this,$,this.getAttribute($)??void 0,void 0):K;this.set($,A,!1)}),p(this)}disconnectedCallback(){}adoptedCallback(){}has($){return this.signals.has($)}get($){let K=(B)=>!_(B)?B:V(B)?K(B()):H(B)?K(B.get()):B;return K(this.signals.get($))}set($,K,A=!0){let B;if(!this.signals.has($))B="Create",this.signals.set($,g(K));else if(A){let j=this.signals.get($);if(H(K)){if(B="Replace",this.signals.set($,K),C(j))j.set(x)}else if(C(j))B="Update",j.set(K);else{Q(K,`Computed state ${k($)} in ${D$(this)} cannot be set`,W);return}}else return}delete($){return this.signals.delete($)}first($){let K=this.root.querySelector($);return new F(this,K?[K]:[])}all($){return new F(this,Array.from(this.root.querySelectorAll($)))}}var G$=($,K=$)=>(A,B)=>L(()=>{B.dispatchEvent(new CustomEvent($,{detail:A.get(K),bubbles:!0}))}),Y=($,K)=>(A,B)=>{let{read:j,update:y}=K,P=j(B);if(!V($)){let J=w($)&&w(P)?N(A,$,P):P;A.set($,J,!1)}L(()=>{let J=j(B),D=V($)?$(J):A.get($);if(!Object.is(D,J)){if(D===null&&K.delete)K.delete(B);else if(D==null&&P)y(B,P);else if(D!=null)y(B,D)}})},O$=($,K)=>Y(K,{read:()=>null,update:(A,B)=>$$(A,$,B)}),q$=($)=>Y($,{read:(K)=>K!=null,update:(K,A)=>A?K$(K):Promise.resolve(null)}),E$=($)=>Y($,{read:(K)=>K.textContent,update:(K,A)=>A$(K,A)}),R$=($,K=$)=>Y(K,{read:(A)=>A[$],update:(A,B)=>A[$]=B}),b$=($,K=$)=>Y(K,{read:(A)=>A.getAttribute($),update:(A,B)=>B$(A,$,B),delete:(A)=>j$(A,$)}),_$=($,K=$)=>Y(K,{read:(A)=>A.hasAttribute($),update:(A,B)=>y$(A,$,B)}),k$=($,K=$)=>Y(K,{read:(A)=>A.classList.contains($),update:(A,B)=>z$(A,$,B)}),g$=($,K=$)=>Y(K,{read:(A)=>A.style.getPropertyValue($),update:(A,B)=>P$(A,$,B),delete:(A)=>Z$(A,$)});export{p as useContext,Y as updateElement,k$ as toggleClass,_$ as toggleAttribute,g as toSignal,E as state,E$ as setText,g$ as setStyle,R$ as setProperty,b$ as setAttribute,q$ as removeElement,N as parse,C as isState,H as isSignal,Z as enqueue,G$ as emit,L as effect,O$ as createElement,X as computed,t as batch,M$ as asString,F$ as asNumber,f$ as asJSON,S$ as asInteger,T$ as asEnum,L$ as asBoolean,l as animationFrame,x as UNSET,I as Capsula};
