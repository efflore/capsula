var e=($)=>typeof $==="function",W$=($)=>e($)&&/^async\s+/.test($.toString()),f=($)=>(B)=>B instanceof $,p=f(Error),Y$=f(Promise);var Q$="Computed",M=($,B)=>{B=B??W$($);let K=new Set,Z,z=null,J=!0,W=()=>{if(J=!0,B)c(K)},A=()=>{try{return $()}catch(V){return p(V)?V:new Error(`Error during reactive computation: ${V}`)}},X=(V)=>{J=!1,Z=V,z=null},z$=(V)=>{J=!0,z=V},J$=(V)=>p(V)?z$(V):X(V),V$={[Symbol.toStringTag]:Q$,get:()=>{if(m(K),!B||J)i(()=>{let V=A();Y$(V)?V.then(J$).catch(z$):J$(V)},W);if(p(z))throw z;return Z},map:(V)=>M(()=>V(V$.get()))};return V$},$$=($)=>!!$&&typeof $==="object"&&$[Symbol.toStringTag]===Q$;var T,T$=!1,P$=new Set,F=($)=>P($)||$$($),m=($)=>{if(T)$.add(T)},c=($)=>$.forEach((B)=>T$?P$.add(B):B()),i=($,B)=>{let K=T;T=B,$(),T=K};class o{$;watchers=new Set;constructor($){this.value=$}get(){return m(this.watchers),this.value}set($){let B=e($)?$(this.value):$;if(Object.is(this.value,B))return;this.value=B,c(this.watchers)}map($){return M(()=>$(this.get()))}}var B$=($)=>new o($),P=f(o);var v=($)=>{let B=()=>i(()=>{try{$()}catch(K){console.error(K)}},B);B()};var I=($)=>typeof $==="function";var y=($)=>(B)=>B instanceof $,s=($)=>y(Error)($),L=function(){return this};var H=($)=>$==null?j():X$($)?$:O($),X$=($)=>b($)||R($);class U{static instance=new U;get=()=>{return}}var w=U.prototype;w.map=w.chain=w.filter=w.guard=w.catch=L;w.or=($)=>H($());w.match=function($){return I($.Nil)?$.Nil():this};var j=()=>U.instance,R=($)=>$===U.instance;class S{$;constructor($){this.value=$}get(){return this.value}}var N=S.prototype;N.map=function($){return new S($(this.value))};N.chain=function($){return $(this.value)};N.filter=N.guard=function($){return $(this.value)?this:j()};N.or=N.catch=L;N.match=function($){return I($.Ok)?$.Ok(this.value):this};var O=($)=>new S($),b=y(S);class _{$;constructor($){this.error=$}get(){throw this.error}}var C=_.prototype;C.map=C.chain=L;C.filter=C.guard=()=>j();C.or=($)=>H($());C.catch=function($){return $(this.error)};C.match=function($){return I($.Err)?$.Err(this.error):this};var n=($)=>new _(s($)?$:new Error(String($))),K$=y(_);var E=($,...B)=>{try{return A$($(...B))}catch(K){return n(K)}};var r=($)=>b($)||R($)||K$($),A$=($)=>$==null?j():r($)?$:s($)?n($):O($);var Y=($)=>typeof $==="function",u=($)=>!!$&&typeof $==="object",y$=($)=>typeof $==="number",q=($)=>typeof $==="string",R$=($)=>typeof $==="symbol",H$=($)=>q($)||R$($)||y$($);var O$="debug";var b$="warn",D="error",_$=($)=>$?`#${$}`:"",E$=($)=>$.length?`.${Array.from($).join(".")}`:"",j$=($)=>`<${$.localName}${_$($.id)}${E$($.classList)}>`,l=($)=>q($)?`"${$}"`:u($)?JSON.stringify($):String($),x=($,B,K=O$)=>{if(!1==="true"||[D,b$].includes(K))console[K](B,$);return $};var k$=($,B)=>{return H$(B)?$.signals.get(B):F(B)?B:Y(B)&&!B.length?M(B):void 0};class k{$;B;constructor($,B=[$]){this.host=$;this.targets=B}on($,B){return this.targets.forEach((K)=>K.addEventListener($,B)),this}off($,B){return this.targets.forEach((K)=>K.removeEventListener($,B)),this}pass($){return this.targets.forEach((B)=>{if(B instanceof g)this.host.constructor.registry.whenDefined(B.tagName).then(()=>{Object.entries($).forEach(([K,Z])=>{let z=k$(this.host,Z);if(z)B.set(K,z);else x(Z,`Invalid source for state ${l(K)}`,D)})});else x(B,"Target is not a Capsula instance",D)}),this}sync(...$){return this.targets.forEach((B)=>$.forEach((K)=>K(this.host,B))),this}}var h=($,B,K,Z=void 0)=>{let z=$.constructor.states[B];return Y(z)&&!!z.length?z(K,$,Z):K},v4=($)=>$!=null,s4=($)=>H($).map(parseInt).filter(Number.isFinite).get(),n4=($)=>H($).map(parseFloat).filter(Number.isFinite).get(),r4=($)=>$,u4=($)=>(B)=>H(B).filter((K)=>$.includes(K.toLowerCase())).get(),l4=($)=>E(()=>$?JSON.parse($):null).match({Err:(B)=>{x(B,"Failed to parse JSON",D);return}}).get();class g extends HTMLElement{static registry=customElements;static states={};static observedAttributes;static consumedContexts;static providedContexts;static define($){E(()=>g.registry.define($,this)).match({Err:(B)=>x($,B.message,D),Ok:()=>!1})}signals=new Map;internals;self=new k(this);root=this.shadowRoot||this;debug=!1;attributeChangedCallback($,B,K){if(K===B)return;this.set($,h(this,$,K,B))}connectedCallback(){Object.entries(this.constructor.states).forEach(([$,B])=>{let K=Y(B)?h(this,$,this.getAttribute($)??void 0,void 0):B;this.set($,K,!1)})}disconnectedCallback(){}adoptedCallback(){}has($){return this.signals.has($)}get($){let B=(Z)=>!u(Z)?Z:Y(Z)?B(Z()):F(Z)||r(Z)?B(Z.get()):Z;return B(this.signals.get($))}set($,B,K=!0){if(!this.signals.has($))this.signals.set($,F(B)?B:Y(B)&&!B.length?M(B):B$(B));else if(K){let Z=this.signals.get($);if(F(B))this.signals.set($,B);else if(P(Z))Z.set(B);else x(B,`Computed state ${l($)} in ${j$(this)} cannot be set`,D)}}delete($){return this.signals.delete($)}first($){let B=this.root.querySelector($);return new k(this,B?[B]:[])}all($){return new k(this,Array.from(this.root.querySelectorAll($)))}}var D$="context-request";class M$ extends Event{$;B;K;constructor($,B,K=!1){super(D$,{bubbles:!0,composed:!0});this.context=$;this.callback=B;this.subscribe=K}}var g$=($)=>{let B=$.constructor,K=B.consumedContexts||[];setTimeout(()=>{for(let z of K)$.dispatchEvent(new M$(z,(J)=>$.set(String(z),J)))});let Z=B.providedContexts||[];if(!Z.length)return!1;return $.addEventListener(D$,(z)=>{let{context:J,callback:W}=z;if(!Z.includes(J)||!Y(W))return;z.stopPropagation(),W($.signals.get(String(J)))}),!0};if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=($)=>setTimeout($,16);var a=new Map,d=[],t,x$=()=>{t=null,d.forEach(($)=>$()),d=[],a.clear()},h$=()=>{if(t)cancelAnimationFrame(t);t=requestAnimationFrame(x$)};queueMicrotask(x$);var Q=($,B)=>new Promise((K,Z)=>{let z=()=>{try{K($())}catch(J){Z(J)}};if(B){let[J,W]=B;if(!a.has(J))a.set(J,new Map);let A=a.get(J);if(A.has(W)){let X=d.indexOf($);if(X>-1)d.splice(X,1)}A.set(W,z)}d.push(z),h$()});var G$=($)=>$.nodeType===Node.COMMENT_NODE,d$=($)=>!/^on/i.test($),f$=($)=>{if(/^(mailto|tel):/i.test($))return!0;if($.includes("://"))try{let B=new URL($,window.location.origin);return!["http:","https:","ftp:"].includes(B.protocol)}catch(B){return!0}return!0},Z$=($,B,K)=>{if(!d$(B))throw new Error(`Unsafe attribute: ${B}`);if(!f$(K))throw new Error(`Unsafe URL for ${B}: ${K}`);$.setAttribute(B,K)};var F$=($,B,K={},Z)=>Q(()=>{let z=document.createElement(B);for(let[J,W]of Object.entries(K))Z$(z,J,W);if(Z)z.textContent=Z;return $.append(z),z},[$,"e"]),I$=($)=>Q(()=>{return $.remove(),null},[$,"r"]),w$=($,B)=>Q(()=>{return Array.from($.childNodes).filter((K)=>!G$(K)).forEach((K)=>K.remove()),$.append(document.createTextNode(B)),$},[$,"t"]),N$=($,B,K)=>Q(()=>{return Z$($,B,K),$},[$,`a:${B}`]),C$=($,B)=>Q(()=>{return $.removeAttribute(B),$},[$,`a:${B}`]),L$=($,B,K)=>Q(()=>{return $.toggleAttribute(B,K),$},[$,`a:${B}`]),U$=($,B,K)=>Q(()=>{return $.classList.toggle(B,K),$},[$,`c:${B}`]),S$=($,B,K)=>Q(()=>{return $.style.setProperty(B,K),$},[$,`s:${B}`]),q$=($,B)=>Q(()=>{return $.style.removeProperty(B),$},[$,`s:${B}`]);var NB=($,B=$)=>(K,Z)=>v(()=>{Z.dispatchEvent(new CustomEvent($,{detail:K.get(B),bubbles:!0}))}),G=($,B)=>(K,Z)=>{let{read:z,update:J}=B,W=z(Z);if(!Y($)){let A=q($)&&q(W)?h(K,$,W):W;K.set($,A,!1)}v(()=>{let A=z(Z),X=Y($)?$(A):K.get($);if(!Object.is(X,A)){if(X===null&&B.delete)B.delete(Z);else if(X==null&&W)J(Z,W);else if(X!=null)J(Z,X)}})},CB=($,B)=>G(B,{read:()=>null,update:(K,Z)=>F$(K,$,Z)}),LB=($)=>G($,{read:(B)=>B!=null,update:(B,K)=>K?I$(B):Promise.resolve(null)}),UB=($)=>G($,{read:(B)=>B.textContent,update:(B,K)=>w$(B,K)}),SB=($,B=$)=>G(B,{read:(K)=>K[$],update:(K,Z)=>K[$]=Z}),qB=($,B=$)=>G(B,{read:(K)=>K.getAttribute($),update:(K,Z)=>N$(K,$,Z),delete:(K)=>C$(K,$)}),TB=($,B=$)=>G(B,{read:(K)=>K.hasAttribute($),update:(K,Z)=>L$(K,$,Z)}),PB=($,B=$)=>G(B,{read:(K)=>K.classList.contains($),update:(K,Z)=>U$(K,$,Z)}),yB=($,B=$)=>G(B,{read:(K)=>K.style.getPropertyValue($),update:(K,Z)=>S$(K,$,Z),delete:(K)=>q$(K,$)});export{g$ as useContext,G as updateElement,PB as toggleClass,TB as toggleAttribute,UB as setText,yB as setStyle,SB as setProperty,qB as setAttribute,LB as removeElement,h as parse,NB as emit,CB as createElement,r4 as asString,n4 as asNumber,l4 as asJSON,s4 as asInteger,u4 as asEnum,v4 as asBoolean,g as Capsula};
